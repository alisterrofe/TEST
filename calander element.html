<!DOCTYPE html>
<html>
<head>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/main.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/main.min.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h1>Google Calendar Integration</h1>
  <div id="calendar"></div>

  <script>
    const API_KEY = 'AIzaSyBeHXRfgY5YMZeqGOdiEjZhvk_hcsRo_xg';
    const CALENDAR_ID = 'alisterrofe@googlemail.com'; // Your calendar ID
    const TIME_ZONE = 'Europe/London'; // Your time zone

    // Initialize Google Calendar API client and fetch events
    async function loadGoogleCalendarEvents() {
      return new Promise((resolve, reject) => {
        gapi.load('client', () => {
          gapi.client
            .init({
              apiKey: API_KEY,
              discoveryDocs: [
                'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest',
              ],
            })
            .then(() => {
              // Fetch events from the specified calendar
              return gapi.client.calendar.events.list({
                calendarId: CALENDAR_ID, // Use your specific calendar ID
                timeMin: new Date().toISOString(), // Fetch events from today onward
                showDeleted: false,
                singleEvents: true,
                maxResults: 20,
                orderBy: 'startTime',
                timeZone: TIME_ZONE, // Set the time zone for events
              });
            })
            .then((response) => {
              const events = response.result.items.map((event) => ({
                title: event.summary,
                start: event.start.dateTime || event.start.date,
                end: event.end.dateTime || event.end.date,
              }));
              resolve(events);
            })
            .catch((err) => reject(err));
        });
      });
    }

    // Initialize FullCalendar with events
    document.addEventListener('DOMContentLoaded', async function () {
      const calendarEl = document.getElementById('calendar');

      try {
        const events = await loadGoogleCalendarEvents();

        const calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          timeZone: TIME_ZONE, // Match calendar's time zone
          events: events, // Add events to the calendar
        });

        calendar.render();
      } catch (error) {
        console.error('Error loading calendar events:', error);
      }
    });
  </script>
</body>
</html>
