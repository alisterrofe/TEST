<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nearby Device Sharing</title>
  <script>
    async function findNearbyDevices() {
      try {
        // Request Bluetooth devices
        const device = await navigator.bluetooth.requestDevice({
          acceptAllDevices: true, // Discover all nearby devices
          optionalServices: ['battery_service'], // Example service
        });

        // Show the device information
        displayDevice(device);

        // Connect to the selected device
        await connectToDevice(device);
      } catch (error) {
        console.error("Error discovering devices:", error);
        alert("Failed to discover nearby devices. Please try again.");
      }
    }

    function displayDevice(device) {
      const deviceContainer = document.getElementById("device-list");
      const deviceInfo = `
        <div style="margin: 10px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
          <strong>Device Name:</strong> ${device.name || "Unknown"}<br>
          <strong>Device ID:</strong> ${device.id}<br>
          <strong>Connected:</strong> ${device.gatt.connected ? "Yes" : "No"}
        </div>
      `;

      deviceContainer.innerHTML += deviceInfo; // Append device info to the list
    }

    async function connectToDevice(device) {
      try {
        if (!device.gatt) {
          alert("This device does not support GATT connection.");
          return;
        }

        const server = await device.gatt.connect();
        alert(`Connected to device: ${device.name || "Unknown"}`);

        // Example: Access a specific service and characteristic (e.g., battery level)
        const service = await server.getPrimaryService('battery_service');
        const characteristic = await service.getCharacteristic('battery_level');
        const value = await characteristic.readValue();

        // Decode the value (assume it's a single byte for battery percentage)
        const batteryLevel = value.getUint8(0);
        alert(`Battery level of ${device.name || "Unknown"}: ${batteryLevel}%`);
      } catch (error) {
        console.error("Error connecting to device:", error);
        alert("Failed to connect to the device: " + error.message);
      }
    }
  </script>
</head>
<body>
  <div style="text-align: center; padding: 20px;">
    <h1>Nearby Device Sharing</h1>
    <p>Click the button below to discover nearby devices and connect to one.</p>
    <button onclick="findNearbyDevices()" style="padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; background-color: #007bff; color: white;">
      Show Nearby Devices
    </button>

    <div id="device-list" style="margin-top: 20px;">
      <!-- Nearby devices will be listed here -->
    </div>
  </div>
</body>
</html>
